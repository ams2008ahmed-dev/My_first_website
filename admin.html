<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ููุญุฉ ุงูุฅุฏุงุฑุฉ - ูุธุงู ุงูุฅุจูุงุบ ุงููุฏุฑุณู</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <div id="loginSection" class="login-container">
      <div class="header">
        <h1>ููุญุฉ ุงูุฅุฏุงุฑุฉ</h1>
        <a href="index.html" class="back-link">โ ุงูุนูุฏุฉ ูููุงุฆูุฉ ุงูุฑุฆูุณูุฉ</a>
      </div>
      <form id="loginForm" class="login-form">
        <div class="form-group">
          <label for="password">ูููุฉ ุงููุฑูุฑ</label>
          <input type="password" id="password" name="password" required>
        </div>
        <button type="submit" class="btn-primary">ุฏุฎูู</button>
      </form>
    </div>

    <div id="adminPanel" class="admin-panel" style="display: none;">
      <div class="header">
        <h1>ููุญุฉ ุงูุฅุฏุงุฑุฉ</h1>
        <div class="admin-actions">
          <button id="changePasswordBtn" class="btn-secondary">ุชุบููุฑ ูููุฉ ุงููุฑูุฑ</button>
          <button id="logoutBtn" class="btn-secondary">ุชุณุฌูู ุงูุฎุฑูุฌ</button>
        </div>
      </div>

      <div class="stats-container" id="statsContainer">
        <div class="stat-card stat-problems">
          <div class="stat-icon">๐ง</div>
          <div class="stat-info">
            <div class="stat-number" id="totalProblems">0</div>
            <div class="stat-label">ุฅุฌูุงูู ุงููุดููุงุช</div>
          </div>
        </div>

        <div class="stat-card stat-ideas">
          <div class="stat-icon">๐ก</div>
          <div class="stat-info">
            <div class="stat-number" id="totalIdeas">0</div>
            <div class="stat-label">ุฅุฌูุงูู ุงูุฃููุงุฑ</div>
          </div>
        </div>

        <div class="stat-card stat-resolved">
          <div class="stat-icon">โ</div>
          <div class="stat-info">
            <div class="stat-number" id="resolvedProblems">0</div>
            <div class="stat-label">ุงููุดููุงุช ุงููุญูููุฉ</div>
          </div>
        </div>

        <div class="stat-card stat-pending">
          <div class="stat-icon">โณ</div>
          <div class="stat-info">
            <div class="stat-number" id="pendingProblems">0</div>
            <div class="stat-label">ุงููุดููุงุช ุงููุนููุฉ</div>
          </div>
        </div>
      </div>

      <div class="filter-tabs">
        <button class="tab-btn active" data-filter="all">ุงููู</button>
        <button class="tab-btn" data-filter="problem">ุงููุดุงูู</button>
        <button class="tab-btn" data-filter="idea">ุงูุฃููุงุฑ</button>
      </div>

      <div id="adminReportsContainer" class="reports-grid">
        <div class="loading">ุฌุงุฑู ุงูุชุญููู...</div>
      </div>
    </div>
  </div>

  <div id="passwordModal" class="modal">
    <div class="modal-content">
      <h2>ุชุบููุฑ ูููุฉ ุงููุฑูุฑ</h2>
      <form id="changePasswordForm">
        <div class="form-group">
          <label for="oldPassword">ูููุฉ ุงููุฑูุฑ ุงููุฏููุฉ</label>
          <input type="password" id="oldPassword" required>
        </div>
        <div class="form-group">
          <label for="newPassword">ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ</label>
          <input type="password" id="newPassword" required>
        </div>
        <div class="modal-actions">
          <button type="submit" class="btn-primary">ุญูุธ</button>
          <button type="button" class="btn-secondary" id="closeModal">ุฅูุบุงุก</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    let allReports = [];
    let currentFilter = 'all';
    let isLoggedIn = false;

    const loginSection = document.getElementById('loginSection');
    const adminPanel = document.getElementById('adminPanel');
    const loginForm = document.getElementById('loginForm');
    const logoutBtn = document.getElementById('logoutBtn');
    const changePasswordBtn = document.getElementById('changePasswordBtn');
    const passwordModal = document.getElementById('passwordModal');
    const changePasswordForm = document.getElementById('changePasswordForm');
    const closeModal = document.getElementById('closeModal');

    function initializeStorage() {
      if (!localStorage.getItem('admin_password')) {
        localStorage.setItem('admin_password', '0000');
      }
      if (!localStorage.getItem('reports')) {
        localStorage.setItem('reports', JSON.stringify([]));
      }
    }

    loginForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const password = document.getElementById('password').value;
      const storedPassword = localStorage.getItem('admin_password');

      if (password === storedPassword) {
        isLoggedIn = true;
        loginSection.style.display = 'none';
        adminPanel.style.display = 'block';
        loadReports();
      } else {
        alert('ูููุฉ ุงููุฑูุฑ ุบูุฑ ุตุญูุญุฉ');
      }
    });

    logoutBtn.addEventListener('click', function() {
      isLoggedIn = false;
      loginSection.style.display = 'block';
      adminPanel.style.display = 'none';
      loginForm.reset();
    });

    changePasswordBtn.addEventListener('click', function() {
      passwordModal.style.display = 'flex';
    });

    closeModal.addEventListener('click', function() {
      passwordModal.style.display = 'none';
      changePasswordForm.reset();
    });

    changePasswordForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const oldPassword = document.getElementById('oldPassword').value;
      const newPassword = document.getElementById('newPassword').value;
      const storedPassword = localStorage.getItem('admin_password');

      if (oldPassword === storedPassword) {
        localStorage.setItem('admin_password', newPassword);
        alert('ุชู ุชุบููุฑ ูููุฉ ุงููุฑูุฑ ุจูุฌุงุญ');
        passwordModal.style.display = 'none';
        changePasswordForm.reset();
      } else {
        alert('ูููุฉ ุงููุฑูุฑ ุงููุฏููุฉ ุบูุฑ ุตุญูุญุฉ');
      }
    });

    function loadStats() {
      const reports = allReports;
      const totalProblems = reports.filter(r => r.type === 'problem').length;
      const totalIdeas = reports.filter(r => r.type === 'idea').length;
      const resolvedProblems = reports.filter(r => r.type === 'problem' && r.is_resolved).length;
      const pendingProblems = reports.filter(r => r.type === 'problem' && !r.is_resolved).length;

      document.getElementById('totalProblems').textContent = totalProblems;
      document.getElementById('totalIdeas').textContent = totalIdeas;
      document.getElementById('resolvedProblems').textContent = resolvedProblems;
      document.getElementById('pendingProblems').textContent = pendingProblems;
    }

    function loadReports() {
      allReports = JSON.parse(localStorage.getItem('reports')) || [];
      displayReports();
      loadStats();
    }

    function displayReports() {
      const container = document.getElementById('adminReportsContainer');
      const filteredReports = currentFilter === 'all' 
        ? allReports 
        : allReports.filter(r => r.type === currentFilter);

      if (filteredReports.length === 0) {
        container.innerHTML = '<div class="empty-state">ูุง ุชูุฌุฏ ุจูุงุบุงุช ุญุงููุงู</div>';
        return;
      }

      container.innerHTML = filteredReports.map(report => `
        <div class="report-card ${report.type}">
          <div class="report-header">
            <span class="report-type">${report.type === 'problem' ? '๐ง ูุดููุฉ' : '๐ก ููุฑุฉ'}</span>
            <div class="admin-controls">
              <button class="icon-btn resolve-btn" data-id="${report.id}" data-resolved="${report.is_resolved}" title="${report.is_resolved ? 'ุฅูุบุงุก ุงูุญู' : 'ูุถุน ุนูุงูุฉ ููุญููู'}">
                ${report.is_resolved ? 'โ' : 'โ'}
              </button>
              <button class="icon-btn delete-btn" data-id="${report.id}" title="ุญุฐู">๐๏ธ</button>
            </div>
          </div>
          ${report.is_resolved ? '<div class="resolved-banner">ุชู ุงูุญู โ</div>' : ''}
          <div class="report-info">
            <p><strong>ุงูุทุงูุจ:</strong> ${report.student_name}</p>
            <p><strong>ุงูุตู:</strong> ${report.grade} - ${report.section}</p>
          </div>
          <div class="report-description">
            <p>${report.description}</p>
          </div>
          ${report.solution_idea ? `
            <div class="solution-idea">
              <strong>ุงูุชุฑุงุญ ุงูุญู:</strong>
              <p>${report.solution_idea}</p>
            </div>
          ` : ''}
          ${report.image_url ? `
            <div class="report-image">
              <img src="${report.image_url}" alt="ุตูุฑุฉ ุงูุจูุงุบ">
            </div>
          ` : ''}
          <div class="report-footer">
            <small>${new Date(report.created_at).toLocaleString('ar-SA')}</small>
          </div>
        </div>
      `).join('');

      document.querySelectorAll('.resolve-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const id = parseInt(this.getAttribute('data-id'));
          const reportIndex = allReports.findIndex(r => r.id === id);
          
          if (reportIndex !== -1) {
            allReports[reportIndex].is_resolved = !allReports[reportIndex].is_resolved;
            localStorage.setItem('reports', JSON.stringify(allReports));
            loadReports();
          }
        });
      });

      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          if (!confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูุจูุงุบุ')) return;

          const id = parseInt(this.getAttribute('data-id'));
          allReports = allReports.filter(r => r.id !== id);
          localStorage.setItem('reports', JSON.stringify(allReports));
          loadReports();
        });
      });
    }

    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        currentFilter = this.getAttribute('data-filter');
        displayReports();
      });
    });

    initializeStorage();
    setInterval(() => {
      if (isLoggedIn) loadReports();
    }, 5000);
  </script>
</body>
</html>
